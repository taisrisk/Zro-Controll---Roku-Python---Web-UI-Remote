{% extends "base.html" %}
{% set title = "User" %}

{% block content %}
  <div class="grid gap-6 lg:grid-cols-3" id="userRoot" data-ip="{{ ip or '' }}">
    <section class="panel panel-pad lg:col-span-2">
      <div class="flex flex-wrap items-end justify-between gap-4">
        <div>
          <h2 class="text-xl font-semibold tracking-tight">Session History</h2>
          <div class="mt-1 text-sm muted">
            {% if ip %}Device <span class="font-mono">{{ ip }}</span>{% else %}Select a device in LAN.{% endif %}
          </div>
        </div>
        <div class="flex items-center gap-2 text-xs muted2">
          <div id="userSpinner" class="spinner hidden" aria-hidden="true"></div>
          <div>Auto-update every 15s</div>
        </div>
      </div>

      {% if error %}
        <div class="mt-4 alert">{{ error }}</div>
      {% endif %}

      <div class="mt-6 grid gap-3 sm:grid-cols-3">
        <div class="kv"><span>today</span><span class="text-right font-mono" id="statToday">—</span></div>
        <div class="kv"><span>week</span><span class="text-right font-mono" id="statWeek">—</span></div>
        <div class="kv"><span>month</span><span class="text-right font-mono" id="statMonth">—</span></div>
      </div>

      <div class="mt-3 kv">
        <span>total</span><span class="text-right font-mono" id="statTotal">—</span>
      </div>

      <div class="mt-6">
        <div class="text-xs muted2 uppercase tracking-widest">Current</div>
        <div class="mt-2 kv">
          <span>app</span><span class="truncate text-right" id="currentApp">—</span>
        </div>
        <div class="mt-2 kv">
          <span>started</span><span class="truncate text-right font-mono" id="currentStart">—</span>
        </div>
      </div>

      <div class="mt-8 flex items-center justify-between gap-3">
        <div class="text-xs muted2 uppercase tracking-widest">Recent Sessions</div>
        <button class="button" id="refreshUserBtn" type="button" {% if not ip %}disabled{% endif %}>Refresh</button>
      </div>

      <div class="mt-3 grid gap-2" id="sessionList">
        <div class="kv skeleton"></div>
        <div class="kv skeleton"></div>
        <div class="kv skeleton"></div>
      </div>
    </section>

    <aside class="panel panel-pad">
      <div class="text-sm font-semibold">This Browser</div>
      <div class="mt-3 kv"><span>user id</span><span class="truncate text-right font-mono" id="userId">—</span></div>
      <div class="mt-2 kv"><span>updated</span><span class="truncate text-right font-mono" id="userUpdated">—</span></div>
      <div class="mt-4 text-xs muted2">
        Sessions are stored locally on this machine per Roku device and per browser.
      </div>
    </aside>
  </div>
{% endblock %}
